import{_ as s,c as a,o as l,d as n}from"./app.8f7889f4.js";const A=JSON.parse('{"title":"web安全相关","description":"","frontmatter":{},"headers":[{"level":2,"title":"xss(Cross-Site Scripting，跨站脚本攻击)","slug":"xss-cross-site-scripting-跨站脚本攻击","link":"#xss-cross-site-scripting-跨站脚本攻击","children":[]},{"level":2,"title":"CSRF（跨站点请求伪造）攻击","slug":"csrf-跨站点请求伪造-攻击","link":"#csrf-跨站点请求伪造-攻击","children":[]},{"level":2,"title":"跨域","slug":"跨域","link":"#跨域","children":[]}],"relativePath":"浏览器原理/web安全.md"}'),o={name:"浏览器原理/web安全.md"},p=n(`<h1 id="web安全相关" tabindex="-1">web安全相关 <a class="header-anchor" href="#web安全相关" aria-hidden="true">#</a></h1><h2 id="xss-cross-site-scripting-跨站脚本攻击" tabindex="-1">xss(Cross-Site Scripting，跨站脚本攻击) <a class="header-anchor" href="#xss-cross-site-scripting-跨站脚本攻击" aria-hidden="true">#</a></h2><h5 id="xss是什么" tabindex="-1">xss是什么？ <a class="header-anchor" href="#xss是什么" aria-hidden="true">#</a></h5><ul><li>本质是：恶意代码未经过滤，和正常的代码混在一起，浏览器无法分辨那些脚本是可信的，恶意代码被执行。由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，利用这些信息冒充用户向网站发起攻击者定义的请求。</li></ul><h5 id="xss的分类" tabindex="-1">xss的分类 <a class="header-anchor" href="#xss的分类" aria-hidden="true">#</a></h5><ol><li>反射性xss（非持久） <ul><li>攻击者把恶意脚本写在url中，引导用户点击url，服务端获取到恶意脚本返回，浏览器解析执行了正常脚本和恶意脚本</li><li>防范：对url的查询参数进行转义后再返回浏览器</li></ul></li><li>存储型xss（持久） <ul><li>在输入框中写入恶意脚本发送给服务端，服务端返回恶意脚本，浏览器解析执行，常见于发帖，评论，用户私信等功能</li><li>防范：前端数据发送前先转义，服务端存入数据库前先转义，前端接收数据前先转义</li></ul></li><li>dom型xss <ul><li>其实就是js代码不够严谨，把恶意代码作为html使用.innerHTML、.outerHTML、.appendChild、document.write()等API插入到了页面中</li><li>防范：对输入内容进行转义，尽量使用.innerText、.textContent、.setAttribute() 等</li></ul></li></ol><h2 id="csrf-跨站点请求伪造-攻击" tabindex="-1">CSRF（跨站点请求伪造）攻击 <a class="header-anchor" href="#csrf-跨站点请求伪造-攻击" aria-hidden="true">#</a></h2><p>典型的攻击流程</p><ol><li><a href="http://xn--a-f38al5vkzdt61bv7l.com" target="_blank" rel="noreferrer">受害者登录a.com</a>，并保留了登录凭证（Cookie）</li><li><a href="http://xn--b-nv6ao4io8bp6po6e00mu47cda4311avpa330h.com" target="_blank" rel="noreferrer">攻击者引诱受害者访问了b.com</a></li><li><a href="http://b.com" target="_blank" rel="noreferrer">b.com</a> 向 <a href="http://a.com" target="_blank" rel="noreferrer">a.com</a> 发送了一个请求：<a href="http://a.com/act=xx%E3%80%82%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%9A%E9%BB%98%E8%AE%A4%E6%90%BA%E5%B8%A6a.com%E7%9A%84Cookie" target="_blank" rel="noreferrer">a.com/act=xx。浏览器会默认携带a.com的Cookie</a></li><li>a.com接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是受害者自己发送的请求</li><li>a.com以受害者的名义执行了act=xx</li><li>攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让a.com执行了自己定义的操作 特点</li><li>攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生</li><li>攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；而不是直接窃取数据</li><li>整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”</li><li>跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪 CSRF的预防</li><li>使用token，让用户的每次请求都携带token（攻击者无法获取到token）</li><li>Samesite Cookie属性：防止外域访问</li></ol><h2 id="跨域" tabindex="-1">跨域 <a class="header-anchor" href="#跨域" aria-hidden="true">#</a></h2><ul><li>跨域是因为浏览器的同源策略，浏览器阻止客户端和服务端通信的问题</li><li>请求跨域了，请求还是会正常发出，服务端也会正常返回结果，只是结果会被浏览器拦截。</li></ul><h5 id="同源策略" tabindex="-1">同源策略 <a class="header-anchor" href="#同源策略" aria-hidden="true">#</a></h5><ul><li>协议、域名、端口三者都要相同，即使不同的两个域名指向的是同一个ip地址也是非同源，</li><li>主要限制三方面： <ul><li>当前域的 js 脚本不能访问其它域下的 cookie、localstorage和 indexDB</li><li>当前域下的 js 脚本不能够操作访问其它域下的 Dom</li><li>当前域下的 ajax 不能跨域请求</li></ul></li></ul><ul><li>同源策略的目的是为了保证用户的信息安全，是对 js 脚本的一种限制，而不是对浏览器的限制</li></ul><h5 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-hidden="true">#</a></h5><ul><li>JSONP（JSON with padding） <ul><li>因为对于一般的 img、script、link 脚本请求都不会有跨域的限制，所以可以通过创建script ，请求一个带参网址实现跨域，后端获取前端声明的回调函数 handleCallback ，并调用执行的方式返回给前端</li><li>优点：兼容性好</li><li>缺点：仅支持 get 请求，可能会遭到 xss 攻击</li></ul></li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">//前端代码</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text/javascript</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    let script = document.createElement(&#39;script&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    script.type = &#39;text/javascript&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    script.src = &#39;http://www.domain.com/login?user=admin&amp;callback=handleCallback&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    document.head.appendChild(script)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    function handleCallback(res) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">         console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(res);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//后端代码</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Koa </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">koa</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Koa</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/api/jsonp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#A6ACCD;">callback</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">(</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> msg </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><ul><li>CORS <ul><li>服务端设置Acess-Control-Allow-origin ，表示可以接收那些域名可以访问资源</li><li>cors又有 简单请求 和 复杂请求</li></ul></li><li>Nginx反向代理</li></ul>`,18),e=[p];function t(r,c,i,D,y,F){return l(),a("div",null,e)}const d=s(o,[["render",t]]);export{A as __pageData,d as default};
